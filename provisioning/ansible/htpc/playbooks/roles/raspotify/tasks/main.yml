---
- name: Copy asound.conf
  ansible.builtin.copy:
    src: files/asound.conf
    dest: /etc/asound.conf

- name: Copy asound.state
  ansible.builtin.copy:
    src: files/asound.state
    dest: /var/lib/alsa/asound.state

- name: Add apt key
  apt_key:
    url: https://dtcooper.github.io/raspotify/key.asc

- name: Add apt repository
  apt_repository:
    repo: deb [arch=armhf,arm64] https://dtcooper.github.io/raspotify raspotify main
    filename: 'raspotify'

- name: Install
  apt:
    name:
      - raspotify
      - asound-conf-wizard
      - libasound2-plugins
    update_cache: true

- name: Configure
  template:
    src: raspotify.conf
    dest: "{{ raspotify_config_file }}"
    mode: "0600"
  notify:
    - restart
