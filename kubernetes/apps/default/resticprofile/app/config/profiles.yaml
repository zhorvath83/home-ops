---
# yaml-language-server: $schema=https://creativeprojects.github.io/resticprofile/jsonschema/config-1.json
version: "1"

global:
    scheduler: crond

default:
  repository: "local:/bckup"
  password-file: "/etc/resticprofile/restic.pwd"
  compression: max
  initialize: true
  verbose: true
  pack-size: 64

  env:
    RESTIC_PROGRESS_FPS: "0.1"
    RESTIC_CACHE_DIR: "/cache"

  backup:
    schedule-log: /logs/resticprofile.log
    schedule: "*:00,05,10,15,30,45"
    schedule-permission: user
    check-before: true
    source:
      - /backups/pgbackups
    exclude:
      - /backups/pgbackups/last
      - /backups/pgbackups/monthly
      - /backups/pgbackups/weekly
    no-error-on-warning: true
    # run-before: |
    #   wget "https://hc-ping.com/FW89_Ui4S7Xe4QLa96f98A/kube-restic-${PROFILE_NAME}-${PROFILE_COMMAND}/start?rid=$(cat /tmp/uuid)" -O - -S --post-data "Profile: $PROFILE_NAME
    #   Command: $PROFILE_COMMAND
    #   "
    # run-finally: |
    #   # Extract lines that don't start with "unchanged " from the log and write them to "backup.log" in the current directory
    #   grep --invert-match -E "^unchanged\\s" {{ tempFile "backup.log" }} > backup.log
    #   rc="${ERROR_EXIT_CODE:-0}";
    #   wget "https://hc-ping.com/FW89_Ui4S7Xe4QLa96f98A/kube-restic-${PROFILE_NAME}-${PROFILE_COMMAND}/${rc}?rid=$(cat /tmp/uuid)" -O - -S --post-data "Profile: $PROFILE_NAME
    #   Command: $PROFILE_COMMAND
    #   Message: $ERROR_MESSAGE
    #   Command-line: $ERROR_COMANDLINE
    #   Stderr: $ERROR_STDERR
    #   "
  forget:
    schedule-permission: user
    schedule-log: /logs/resticprofile.log
    keep-hourly: 24
    keep-daily: 14
    keep-monthly: 24
    keep-weekly: 12
    prune: true

  check:
    schedule-permission: user
    schedule-log: /logs/resticprofile.log
    read-data-subset: "50M"
