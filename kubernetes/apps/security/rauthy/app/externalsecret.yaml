---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rauthy
  namespace: security
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: rauthy-secret
    creationPolicy: Owner
    template:
      data:
        # rauthy
        CLUSTER_SECRET_RAFT: "{{ .CLUSTER_SECRET_RAFT }}"
        CLUSTER_SECRET_API: "{{ .CLUSTER_SECRET_API }}"
        ENC_KEYS: "{{ .ENC_KEYS }}"
        ENC_KEY_ACTIVE: "{{ .ENC_KEY_ACTIVE }}"
        BOOTSTRAP_ADMIN_EMAIL: "{{ .BOOTSTRAP_ADMIN_EMAIL }}"
        EVENT_EMAIL: "{{ .EVENT_EMAIL }}"
        # smtp-relay
        SMTP_URL: "{{ .SMTP_RELAY_HOSTNAME }}"
        SMTP_USERNAME: "{{ .SMTP_RELAY_USERNAME }}"
        SMTP_PASSWORD: "{{ .SMTP_RELAY_PASSWORD }}"
        SMTP_FROM: "Rauthy <{{ .SMTP_RELAY_USERNAME }}>"
  dataFrom:
    - extract:
        key: rauthy
    - extract:
        key: smtp-relay
